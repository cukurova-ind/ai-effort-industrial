{% extends "main_template.html" %}
{% load static %}

{% block title %}

Veri seti

{% endblock %}


{% block content %}
<div class="container-fluid data-settings">
    
    <div class="container-fluid d-flex justify-content-between align-items-center mb-3 top-container">
        <div class="text-start">
            <h2 class="mb-0">Ayarlar</h2>
        </div>
        <div class="text-end">
            <strong><a>{{ profile_name|default:'unknownprofile' }}</a></strong>
        </div>
    </div>
    <hr>

    <div class="container-fluid main-container">
        <div class="row">
            <div class="col-md-2">
                <div class="border rounded p-2" style="max-height: 400px; overflow-y: auto;">
                    <h5 class="mb-2">Kayıtlı Profiller</h5>
                    <div class="d-flex flex-column gap-2">
                        {% for profile in profiles %}
                            <a href="{% url 'data_settings_with_profile' profile %}" class="text-decoration-none text-dark text-italic">
                                {{ profile }}
                            </a>
                        {% empty %}
                            <div class="text-muted">Kayıtlı profil yok</div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="col-md-10">
                <form method="post" id="settingsForm">
                {% csrf_token %}
                    <div class="text-start">
                        <p class="mb-0"><strong>1. Girdi Değişkenleri</strong></p>
                    </div>
                    <hr>
                    <div class="table-container">

                        <div class="scroll-container border rounded">

                            <table class="table table-bordered table-hover table-striped table-fixed align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        {% for col in columns %}
                                        <th>
                                            <input class="form-check-input input_columns" type="checkbox"
                                                id="inp_{{ col.column }}" data-label="{{ col.label }}"
                                                name="inp_{{ col.column }}" value="{{ col.column }}" 
                                                {% if col.input_checked %}checked{% endif %}>
                                            <label for="inp_{{ col.column }}" class="form-label">&nbsp;{{ col.label }}</label>
                                            <p>{{ col.attr_type }}</p>
                                            <p>{{ col.d_type }}</p>
                                        </th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for row in rows %}
                                    <tr>
                                        {% for r in row %}
                                        <td>{{ r }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                <div class="buttons-container">
                    <button type="button" id="checkAllBtn" class="btn btn-sm btn-primary me-2">Hepsini Seç</button>
                    <button type="button" id="uncheckAllBtn" class="btn btn-sm btn-secondary">Hepsini Kaldır</button>
                </div>
                <label for="id_selection" class="form-label">Seçilenler</label>
                <input class="form-control" type="text" id="id_selection" name="input_list" value="" readonly>
                <hr>
                <div class="text-start">
                    <p class="mb-0"><strong>2. Çıktı Değişkenleri</strong></p>
                </div>
                <hr>
                <div class="table-container">

                    <div class="scroll-container border rounded">

                        <table class="table table-bordered table-hover table-striped table-fixed align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    {% for col in columns %}
                                    <th>
                                        <input class="form-check-input output_columns" type="checkbox"
                                            id="id_{{ col.column }}" name="out_{{ col.column }}"
                                            data-label="{{ col.label }}" value="{{ col.column }}"
                                            {% if col.target_checked %}checked{% endif %}>
                                        <label for="id_{{ col.column }}" class="form-label">&nbsp;{{ col.label }}</label>
                                        <p>{{ col.attr_type }}</p>
                                        <p>{{ col.d_type }}</p>
                                    </th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in rows %}
                                <tr>
                                    {% for r in row %}
                                    <td>{{ r }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>

                    </div>
                </div>
                <label for="id_selection_output" class="form-label">Seçilenler</label>
                <input class="form-control" type="text" id="id_selection_output" name="output_list" value="" readonly>
                <hr>

                <hr>
                <div class="text-start">
                    <p class="mb-0"><strong>3. Veri Bölümleme (Optional)</strong></p>
                </div>
                <hr>

                <div class="mb-3 row">
                    <div class="col-md-9">
                        <label for="test_size" class="form-label">Test Size [0, 0.9]</label>
                        <input name="test_size" type="number" min="0" max="0.9" step="0.05" class="form-control"
                            id="test_size" value="{% if conf.test_size %}{{ conf.test_size }}{% else %}0.0{% endif %}">
                    </div>
                    <div class="col-md-3">
                        <label for="random_state" class="form-label">Random State (Tamsayı)</label>
                        <input name="random_state" type="number" min="-1" max="1111" step="1" class="form-control"
                            id="random_state" value="{% if conf.random_state %}{{ conf.random_state }}{% else %}-1{% endif %}">
                    </div>
                </div>
                <div class="buttons-container">
                    <button class="btn btn-primary text-center" id="trainDownload" type="button">Train Set İndir</button>
                    <button class="btn btn-primary text-center" id="testDownload" type="button">Test Set İndir</button>
                    <span id="download-err"></span>
                </div>

                <hr>
                <div class="text-start">
                    <p class="mb-0"><strong>4. Değişken Ölçekleme (Sadece Girdiler) (Optional)</strong></p>
                </div>
                <hr>

                <div class="mb-3 row">
                    <div class="col-md-12">
                        <label for="scale" class="form-label">Ölçekleme</label>
                        <select name="input_scaling" class="form-select">
                            {% if conf.input_scaling == "norm1" %}
                            <option value="norm1" selected>Normalizasyon [0,1]</option>
                            {% else %}
                            <option value="norm1">Normalizasyon [0,1]</option>
                            {% endif %}

                            {% if conf.input_scaling == "norm2" %}
                            <option value="norm2" selected>Normalizasyon [-1,1]</option>
                            {% else %}
                            <option value="norm2">Normalizasyon [-1,1]</option>
                            {% endif %}

                            {% if conf.input_scaling == "off" %}
                            <option value="off" selected>Yok</option>
                            {% else %}
                            <option value="off">Yok</option>
                            {% endif %}

                        </select>
                    </div>
                </div>

                <hr>
                <div class="text-start">
                    <p class="mb-0"><strong>5. Eğitim Ayarları</strong></p>
                </div>
                <hr>
                
                <div class="mb-3 row">
                    <div class="col-md-6">
                        <label for="model_type" class="form-label">Model Tipi</label>
                        <select name="model" class="form-select" id="model_type">

                            {% if conf.model_type == "mlp" %}
                            <option value="mlp" selected>Multilayer Perceptron</option>
                            {% else %}
                            <option value="mlp">Multilayer Perceptron</option>
                            {% endif %}

                            {% if conf.model_type == "ml" %}
                            <option value="ml" selected>Machine Learning Collection</option>
                            {% else %}
                            <option value="ml">Machine Learning Collection</option>
                            {% endif %}

                        </select>
                    </div>

                    <div class="col-md-2">
                        <div class="form-check form-switch py-3" id="re-train">
                            <input class="form-check-input" type="checkbox" role="switch" id="retrain" name="retrain"
                            {% if conf.retrain == 'on' %}checked{% endif %}>
                            <label for="retrain" class="form-label">Yeniden Eğitim?</label>
                        </div>

                    </div>

                    <div class="col-md-4">

                        <label for="saved_model" class="form-label">Kayıtlı Model</label>
                        <select name="saved_model" class="form-select" id="saved_model" disabled>
                            {% if conf.retraining_model_name %}
                            <option value="{{ conf.retraining_model_name }}">{{ conf.retraining_model_name }}</option>
                            {% endif %}
                        </select>
                    </div>
                </div>

                <div class="mb-3 row">

                    <div class="col-md-3">
                        <label for="batch" class="form-label">Veri Seti Batch Büyüklüğü</label>
                        <input name="batch_size" type="number" class="form-control" id="batch"
                        min="4" max="256" step="4" 
                        value="{% if conf.batch_size %}{{ conf.batch_size }}{% else %}16{% endif %}">
                    </div>

                    <div class="col-md-3">
                        <label for="epoch" class="form-label">Training Epoch Sayısı</label>
                        <input name="n_epoch" type="number" class="form-control" id="epoch"
                        min="1" max="10000" step="1" 
                        value="{% if conf.n_epoch %}{{ conf.n_epoch }}{% else %}1{% endif %}">
                    </div>

                    <div class="col-md-3">
                        <label for="loss_function" class="form-label">Hata Fonksiyonu</label>
                        <select name="loss_function" class="form-select" id="loss_function">

                            <option value="mse" {% if conf.loss_function == 'mse' %}selected{% endif %}>Mean Squared Error (MSE)</option>
                            <option value="mae" {% if conf.loss_function == 'mae' %}selected{% endif %}>Mean Absolute Error (MAE)</option>
                            <option value="mape" {% if conf.loss_function == 'mape' %}selected{% endif %}>Mean Absolute Percentage Error (MAPE)</option>

                        </select>
                    </div>

                    <div class="col-md-3">
                        <label for="learning_rate" class="form-label">Öğrenme Oranı (AdaM)</label>
                        <input name="learning_rate" type="number" class="form-control" id="learning_rate" 
                        min="0.0000001" max="0.1" step="0.001"
                        value="{% if conf.learning_rate %}{{ conf.learning_rate }}{% else %}0.001{% endif %}">
                    </div>

                </div>

                <div class="mb-3 row">

                    <label for="batch" class="form-label">Validasyon Bölümü (Eğitim Setinden)</label>
                    <div class="col-md-2">

                        <input class="form-check-input" type="checkbox" id="single_val"
                            name="single_val" {% if conf.single_shot_validation == 'on' %}checked{% endif %}>
                        <label for="single_val" class="form-label">Her epoch sabit</label>

                    </div>

                    <div class="col-md-2">

                        <label for="val_size" class="form-label">Val Size [0, 0.5]</label>
                        <input name="val_size" type="number" min="0" max="0.5" step="0.05" class="form-control"
                            id="val_size" value="{% if conf.val_size %}{{ conf.val_size }}{% else %}0.0{% endif %}">

                    </div>

                </div>
                <input type="hidden" id="currentProfile" name="currentProfileName" value="{{ profile_name|default:'unknownprofile' }}">
                <hr>
                <button class="btn btn-success text-center" id="saveUpdate" type="button" disabled=true>Kaydet / Güncelle</button>
                <button class="btn btn-primary text-center" id="skip" type="button" >Devam</button>
                <button class="btn btn-secondary text-center pull-right" id="noSave" type="button" disabled=true>Kaydetmeden Devam</button>
                <p class="text-center text-danger" id="err"></p>
                <div id="namePrompt" style="display: none;">
                    <div class="col-md-2">
                        <label for="newProfileName">Profil ismi girin:</label>
                        <input type="text" id="newProfileName" name="newProfileName" class="form-control">
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}